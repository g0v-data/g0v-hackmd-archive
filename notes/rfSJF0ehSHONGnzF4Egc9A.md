# chapter9
**檔案系統 (File System)** 是作業系統的一個重要組成部分，用來管理和組織儲存裝置上的數據。以下是關於檔案系統的主要概念和結構的繁體中文解釋：  

---

### **介面 (Interface)**  
檔案系統提供一個介面，讓使用者或應用程式能方便地存取儲存裝置上的數據，而不需要了解底層的物理儲存細節。

---

### **檔案概念 (File Concept)**  
- **檔案** 是由作業系統創建的一個邏輯儲存單元，用來儲存數據或程式。  
- 與磁碟上的**物理儲存單元**（如磁軌、磁區）不同，檔案是使用者可理解的數據結構。  
- **檔案類型：**  
  1. **數據檔案 (Data File)：** 儲存文字、圖片、音訊等資料。  
  2. **程式檔案 (Program File)：** 儲存執行的指令或程式碼。  
- **內容：** 檔案的具體內容由檔案的創建者決定。

---

### **存取方法 (Access Methods)**  
- 提供不同的方式來讀取或寫入檔案，例如：  
  1. **順序存取 (Sequential Access)：** 依次從頭到尾存取檔案內容。  
  2. **隨機存取 (Random Access)：** 可以直接跳到檔案的某個位置進行操作。

---

### **目錄結構 (Directory Structure)**  
- 用來組織和管理檔案的結構，類似於樹狀結構：  
  - **單層目錄 (Single-Level Directory)：** 所有檔案都儲存在一個目錄中。  
  - **雙層目錄 (Two-Level Directory)：** 每個使用者有自己專屬的目錄。  
  - **分層目錄 (Hierarchical Directory)：** 允許子目錄的存在，形成樹狀結構。  

---

### **檔案系統掛載 (File-System Mounting)**  
- 將檔案系統與作業系統關聯，使得特定的儲存裝置（如磁碟分區）可被使用。  
- **掛載點 (Mount Point)：** 檔案系統與目錄結構相連的地方。

---

### **檔案共享 (File Sharing)**  
- 多個使用者或系統可以同時存取同一檔案。  
- 可能面臨的挑戰：  
  1. 存取控制權限的設定。  
  2. 資料同步問題。

---

### **保護 (Protection)**  
- 防止未經授權的使用者存取或修改檔案。  
- 常用機制：  
  1. **存取控制 (Access Control)：** 設定誰可以讀取、寫入或執行檔案。  
  2. **加密 (Encryption)：** 保護檔案內容免受惡意攻擊。

---

### **實現方式 (Implementation)**  
#### **檔案系統結構 (File-System Structure)**  
- 檔案系統由多層結構組成：  
  1. 使用者層：提供介面。  
  2. 邏輯層：負責檔案與磁碟的邏輯映射。  
  3. 物理層：管理實際的磁碟空間。  

#### **檔案系統實現 (File-System Implementation)**  
- 涉及如何儲存、檢索和管理檔案的元數據及實際數據。  

---

### **配置方式 (Allocation Methods)**  
- 確定如何將磁碟空間分配給檔案：  
  1. **連續配置 (Contiguous Allocation)：** 檔案的所有區塊連續存放。  
  2. **連結配置 (Linked Allocation)：** 每個區塊保存下一區塊的指標。  
  3. **索引配置 (Indexed Allocation)：** 使用索引節點來記錄檔案的所有區塊位置。  

---

### **空間管理 (Free-Space Management)**  
- 負責追蹤磁碟上未使用的空間：  
  1. **位元圖法 (Bit Vector)：** 用位元表示每個區塊的使用狀態。  
  2. **連結法 (Linked List)：** 使用鏈表記錄空閒區塊。  
  3. **群集法 (Grouping)：** 將空閒區塊分組儲存。  

--- 

透過上述機制，檔案系統能有效率地管理儲存裝置，滿足使用者的需求並保證資料的安全性和一致性。

### **檔案屬性 (File Attributes)**  
檔案的屬性是用來描述檔案的特徵及其相關資訊。以下是主要屬性：  

1. **名稱 (Name)：**  
   - 人類可讀的唯一名稱，用來標識檔案。  
2. **識別碼 (Identifier)：**  
   - 一個唯一的標籤（通常是數字），用來在檔案系統中識別該檔案。  
3. **類型 (Type)：**  
   - 系統需要此資訊來支援不同類型的檔案，例如文字檔案、執行檔案或多媒體檔案。  
4. **位置 (Location)：**  
   - 檔案在儲存裝置上的位址指標，用於定位檔案的實際存放位置。  
5. **大小 (Size)：**  
   - 檔案的當前大小（通常以位元組為單位）。  
6. **保護 (Protection)：**  
   - 控制檔案的存取權限，例如誰可以讀取、寫入或執行該檔案。  
7. **時間、日期及使用者識別 (Time, Date, and User Identification)：**  
   - 用於保護、記錄檔案的安全性以及監控其使用情況。  

---

### **檔案操作 (File Operations)**  
檔案系統允許使用者或程式進行各種操作。以下是常見的檔案操作：  

1. **建立 (Create)：**  
   - 建立一個新檔案並分配空間給它。  
2. **寫入 (Write)：**  
   - 從**寫入指標 (Write Pointer)** 所在的位置向檔案寫入數據。  
3. **讀取 (Read)：**  
   - 從**讀取指標 (Read Pointer)** 所在的位置讀取檔案的內容。  
4. **重新定位 (Reposition Within File, Seek)：**  
   - 將讀寫指標移動到檔案的不同位置，方便進行隨機存取。  
5. **刪除 (Delete)：**  
   - 從檔案系統中移除檔案，並釋放其佔用的儲存空間。  
6. **截斷/連接 (Truncate/Concatenate)：**  
   - **截斷 (Truncate)：** 刪除檔案的部分內容，使其縮小到指定大小。  
   - **連接 (Concatenate)：** 將另一個檔案的內容附加到當前檔案後。  

---

### **作業流程與表格管理**  

1. **處理：開檔表 (Process: Open-File Table)**  
   - 每個進程有一個專屬的**開檔表**，記錄該進程當前開啟的檔案及其相關資訊（例如指標位置、權限等）。  

2. **作業系統：全域檔案表 (Global File Table)**  
   - 作業系統維護一個**全域檔案表**，用來記錄所有正在被系統使用的檔案，包括開啟次數、檔案屬性等共享資訊。  

--- 

這些操作和屬性確保檔案系統能有效地管理檔案，同時為使用者提供便利性與安全性。

### **開檔表 (Open-File Tables)**  

檔案系統使用開檔表來管理進程和系統中已開啟的檔案，分為**每個進程的開檔表**和**系統範圍的全域開檔表**：  

#### **1. 每個進程的開檔表 (Per-Process Open-File Table)**  
- 每個進程維護自己的開檔表，用來追蹤該進程所開啟的所有檔案。  
- 每個開檔表條目包括：  
  1. **當前檔案指標 (Current File Pointer)：** 指示檔案操作的當前位置，例如讀寫的起點。  
  2. **存取權限 (Access Rights)：** 定義進程對檔案的存取類型（讀取、寫入、執行）。  
  3. **記錄資訊 (Accounting Information)：** 用於跟蹤與該檔案相關的操作細節。  

#### **2. 系統範圍的開檔表 (System-Wide Open-File Table)**  
- 作業系統維護一個全域的開檔表，儲存所有目前開啟檔案的進程無關資訊。  
- 每個進程的開檔表條目會指向系統範圍的開檔表，便於共享與管理。  
- 全域開檔表的內容包括：  
  1. **磁碟位置 (Disk Location)：** 檔案在儲存裝置上的位址。  
  2. **存取日期 (Access Dates)：** 記錄檔案最近的使用日期和時間。  
  3. **檔案大小 (File Size)：** 紀錄檔案的總大小。  
  4. **開啟次數 (Open Count)：** 追蹤檔案被多少進程同時開啟，用於決定檔案的關閉時機。

---

### **存取方法 (Access Methods)**  

檔案系統支援不同的存取方式來操作檔案數據，以下是三種主要存取方法的解釋：  

#### **1. 順序存取 (Sequential Access)**  
- 按照固定的順序依次讀取或寫入檔案的數據。  
- **操作：**  
  1. **讀取/寫入下一區塊 (Read/Write Next Block)：** 讀取或寫入當前指標位置的下一筆記錄。  
  2. **重置 (Reset)：** 將檔案指標重定位到檔案開頭。  
  3. **跳過/倒帶 n 筆記錄 (Skip/Rewind n Records)：** 直接跳過或返回特定數量的記錄。  
- **例子：** 類似於操作錄影帶或磁帶，需按順序快進或倒帶來存取資料。  

---

#### **2. 直接存取 (Direct Access)**  
- 又稱相對存取 (Relative Access)，允許直接存取檔案中的任意位置。  
- **操作：**  
  - 使用檔案區塊號 (Block #) 作為參數，指定位於檔案中的目標數據位置。  
- **特點：**  
  - 更靈活，適合需要快速定位檔案特定部分的應用。  
  - 此方法通常也被稱為隨機存取 (Random Access)，因為存取模式的隨機性與直接定位能力。  

---

#### **3. 索引存取 (Index Access)**  
- 利用索引結構來快速定位檔案中的數據區塊。  
- **操作流程：**  
  1. **搜尋索引檔案 (Search the Index File)：** 找到目標數據的指標 (Pointer)。  
  2. **利用指標 (Use the Pointer)：** 根據指標直接存取數據區塊。  
- **特點：**  
  - 適用於大型檔案，特別是在需要頻繁查找特定記錄的情況下。  
  - 如果檔案過大，索引本身可能會變得過於龐大，影響效能。  

---

這些存取方法提供了不同的彈性與效率，根據應用需求選擇適合的方式可以優化檔案系統的效能和操作體驗。

