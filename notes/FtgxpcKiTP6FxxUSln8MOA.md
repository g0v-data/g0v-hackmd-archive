# MainGameTask 遊戲流程與設計分析

## 概述

**MainGameTask** 是專為自閉症譜系障礙（ASD）兒童設計的 VR 社交技能訓練系統，主要透過拋接球活動來提升社交互動能力。系統採用事件驅動架構，結合豐富的動畫、音效和互動機制。

## 核心遊戲流程架構

### 基本流程結構

MainGameTask 採用基於狀態的流程控制，包含三個核心階段：

1. **遊戲說明階段（Explain）**
   - 系統進行遊戲規則說明
   - NPC 主持人介紹拋接球基本操作
   - 建立使用者對任務要求的理解

2. **接球階段（Catch）**
   - **眼神接觸檢測**：與 NPC 進行 4 秒眼神接觸
   - **雙手動作**：將雙手放置在綠色觸發球內並維持指定時間
   - **語音回應**：使用者需要說出「好」確認準備完成
   - **深呼吸練習**：完成放鬆呼吸動作

3. **投球階段（Throw）**
   - 系統判斷投球時機適當性
   - 根據 NPC 姿勢和眼神方向決定投球時機
   - 使用者在正確時機進行投球動作

## 循環次數與模式架構

### 訓練模式（Training Mode）
**目標：獲得 7 個金幣**

- **第一輪（Round 1）- 教學示範階段**
  1. `Explain()` - 遊戲說明（獲得1個金幣）
  2. `Catch()` - 接球練習（獲得1個金幣）  
  3. `Throw()` - 投球練習（獲得1個金幣）

- **第二輪（Round 2）- 加入干擾練習**
  1. `NPCThrow()` - NPC投球
  2. `Catch()` - 接球（獲得1個金幣）
  3. `Throw()` - 投球（獲得1個金幣）
  - *此輪出現腳踏車干擾物*

- **第三輪（Round 3）- 失敗處理練習**
  1. `NPCThrow_Fail()` - NPC故意投球失敗
  2. `Catch_Fail()` - 處理接球失敗的情緒管理
  3. `Throw()` - 投球（獲得1個金幣）
  - *此輪出現泡泡干擾物*

- **後續循環**
  - 繼續重複練習直到累積滿 7 個金幣
  - Round 4: 左側飛機干擾
  - 持續循環直到達成目標

### 挑戰模式（Challenge Mode）
**目標：獲得 10 個金幣**

- **第二輪**：`Catch_Fail()` - 小星投球給使用者失敗，小星會再投一次
- **第三輪**：`Throw_Fail()` - 使用者投球給小花失敗，使用者需要重新投球
- **第四輪及以後**：全部正常流程，直到獲得10個金幣

## NPC 投球機制

### 計劃性失敗設計

**並非每次都成功**！系統採用精心設計的失敗機制：

- **訓練模式第三輪**：`NPCThrow_Fail()` - 小星故意在沒有叫使用者名字的情況下亂投球
- **失敗動畫**：`FatherBox.GetComponent<Animator>().Play("SonBall fail")`
- **教學目的**：教導使用者如何處理不當社交互動

### 失敗後的支持機制

每次失敗後都包含：
- **情緒調節練習**（深呼吸）
- **情感表達訓練**（說出感受）
- **重新嘗試機會**（"沒關係，我們再試一次"）

## 深呼吸練習機制

### 出現時機

**並非只在失敗時出現**！採用教學先行，應用後續的設計：

1. **遊戲說明階段（Explain）- 教學階段**
   - 在 71.48 秒教學影片中，小星先教導深呼吸技巧
   - 作為基礎技能教學，為後續挫折情境做準備

2. **失敗情境中的應用階段**
   - **Catch_Fail**：「我們來練習剛剛跟小星一起學到的深呼吸」
   - **Throw_Fail**：「我們來做深呼吸八!」

### 互動機制

- **視覺提示**：氣球縮放動畫
- **聽覺指導**：「吸~(3秒)吐~(3秒)」
- **生理監測**：透過呼吸感測器追蹤實際呼吸狀態
- **即時回饋**：根據呼吸深度調整氣球大小

## 智慧化學習輔助機制

### 漸進式提示功能

當使用者在規定時間內未完成動作時，系統依序提供不同層級協助：

1. **第一層提示**：NPC 重複呼叫使用者姓名  
2. **第二層提示**：提供語音指導說明  
3. **第三層提示**：顯示視覺箭頭指示器，直接引導使用者完成動作

這種設計遵循教育心理學的「最近發展區」理論，確保學習者獲得適當支援。

## 狀態管理系統

### 核心狀態變數

- `_isEyeFinish`：眼神接觸完成狀態
- `_isHandFinish`：雙手動作完成狀態  
- `_isUserSayYes`：語音回應完成狀態
- `_isBreathFinish`：深呼吸完成狀態
- `_is5secTimeUp`：時間限制監控
- `round`：回合數追蹤

每個狀態都有明確的觸發條件和轉換邏輯，確保遊戲流程的穩定性和可控性。

## 豐富的多媒體設計

### NPC 角色動畫

**小星（大象哥哥）動畫**：
- `"丟球"` - 投球動作
- `"持球眨眼 to 持球叫User名字"` - 呼叫使用者動畫
- `"持球眨眼 to 持球說話提醒"` - 語音提醒動畫
- `"深呼吸"` - 示範深呼吸動作
- `"難過 + 說話 (沒球)"` - 道歉動畫

**小花（企鵝姊姊）動畫**：
- `"高舉過頭說好"` - 準備接球動畫
- `"伸出雙手說好"` - 另一種接球準備動畫
- `"站著不接球"` - 故意不接球動畫
- `"接到球"` - 成功接球動畫
- `"雙手擺著不接球 + 皺眉 + 說話"` - 拒絕接球動畫

### 球的飛行動畫系統

**FatherBox + Parabola 系統**：

- **正常投球**：`"SonBall short"` + Parabola 拋物線軌跡
- **失敗投球**：`"SonBall fail"` + `"SonBall fail-flower"`

### Timeline 編排系統

- **`NPCThrowBallTimeline`** - 訓練模式完整投球序列（26.52秒）
- **`NPCThrowBallTimeline_Challenge`** - 挑戰模式版本（17.54秒）
- **`NPCThrowBallFailTimeline`** - 故意失敗投球序列（74.33秒）

### 音效設計

**NPC 語音反饋**：

- 小星：「我在叫你~~你要看我拉」、「對不起，我再試一次」
- 小花：「好」、「我還沒準備好!」

**主持人反饋**：

- 成功讚美：「你真厲害! 恭喜你成功接到球，獲得一枚金幣!」
- 失敗鼓勵：「沒關係我們再試一次」

**特殊音效**：

- 金幣音效搭配動畫
- 語音辨識提示音

### 視覺特效系統

**成功回饋動畫**：

- 金幣動畫 + 音效
- 主持人拍手動畫
- UI金幣數量更新動畫

**輔助視覺提示**：

- 視覺箭頭指示器
- 綠色接球球、紅色投球球
- 氣球動畫（深呼吸回饋）

## 全方位數據收集機制

系統詳細記錄使用者行為數據：

- **反應時間數據**：從刺激出現到使用者開始反應的時間間隔
- **完成時間數據**：完成整個任務所需的總時間
- **提醒次數記錄**：追蹤需要多少次提示才能完成任務
- **眼動追蹤數據**：記錄使用者的注視焦點變化軌跡
- **語音內容分析**：保存使用者的具體發音內容和說話時間
- **投球狀態記錄**：「可丟球 有丟」、「可丟球 未丟」、「不可丟球 有丟」等

## 事件驅動架構優勢

### GameEventCenter 實現

系統採用事件驅動架構，實現「發佈-訂閱」模式：

- 任務完成時只需發佈事件，所有相關組件自動收到通知
- 提供高度的模組化和可擴展性
- 減少組件間的耦合度
- 便於後續功能擴展和系統維護

### 典型事件處理

```csharp
GameEventCenter.DispatchEvent("GameCoinCounter");        // 金幣數量加一
GameEventCenter.DispatchEvent("ShareTimerRecord", "Catch_CompletionTime");  // 記錄完成時間
GameEventCenter.DispatchEvent("wayPointArrowLook_isEnabled", true);         // 顯示視覺提示
```

## 教育價值與設計理念

### 教育心理學應用

1. **真實社交情境模擬**：透過計劃性失敗模擬現實社交挫折
2. **情緒調節訓練**：教導適當的情緒反應和調節技巧
3. **漸進式挑戰**：從訓練模式到挑戰模式的能力建構
4. **預防性技能建立**：預先教導應對策略而非被動反應

### 技術創新特點

1. **模組化設計**：複雜系統分解為可管理的組件
2. **介面導向編程**：透過抽象層提高系統靈活性
3. **數據驅動決策**：收集和利用行為數據進行個人化調整
4. **多感官整合**：結合視覺、聽覺、觸覺的協調體驗

## 結論

MainGameTask 展現了現代教育技術的先進應用，結合 VR 技術、行為分析和適應性學習機制，為自閉症兒童提供個人化的社交技能訓練環境。其精密的狀態管理、豐富的多媒體設計和全方位的數據收集機制，不僅確保訓練的有效性，也為研究人員提供豐富的行為分析資料。

整個系統體現了「成功與失敗並存」的設計理念，讓訓練體驗更貼近真實社交情境，有效提升自閉症兒童應對複雜社交狀況的能力。
