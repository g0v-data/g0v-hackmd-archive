{"BRsJOevWSbyUMBSZEVVWrA":{"content":"\n- rumors-site is stateless, should be able to run on cloud run.\n- rumors-line-bot 的 MongoDB 可以考慮轉到 https://www.mongodb.com/cloud/atlas/mongodb-google-cloud 一起管理 --> done on 2023/12/5\n- rumors-line-bot uses redis, 但 Google cloud 的 redis （Memorystore）超爆貴，接近 50usd/mo\n    - 可以用 redis cloud, free 30MB / 100MB for 5usd/mo (no HA) ![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_53e030a0192a5b4d5d2996ab29ec64d9.png)\n    - 如果一定要架在台灣 --> [...","tags":[["# Cofacts Chatbot Platform Resilience Improvement Plan",""],["",""],["整理 Cofacts 在不同層級上可用於提升穩定性、安全性與 scalability 的方式，以應對可能到來的威脅。",""],["",""],["## Infrastructure layer 基建層",""],["",""],["重心：機器安全、服務運作與近用",""],["",""],["- 伺服器架構",""],["- 主機存取權限管理",""],["- root access",""],["- ssh access (`authorized_keys`)",""],["- firewall settings",""],["- 主機資源使用率",""],["- ram, cpu, disk usage",""],["- elasticsearch",""],["- url-resolver",""],["- AI",""],["- OS security patches",""],["- Monitoring of infrastructure",""],["- fail2ban",""],["- ram / cpu / disk alerts",""],["- Open source / third party platform access",""],["- Docker hub (runtime images)",""],["- Github (source code)",""],["- API, chatbot, web 使用資源",""],["- dependency vulnerability and security patch",""],["- update tech stack e.g. old nextjs",""],["- CDN",""],["- g0v.tw","直連"],["- cofacts.tw","擋一層 cloudflare"],["- Monitoring of access",""],["- know where a request comes from",""],["- IP",""],["- [API key](https","//g0v.hackmd.io/@mrorz/cofacts-rd/%2F51wwLHgvSUqtBDaP-yAVnA) mechanism"],["- Block requests without API secret / signature",""],["- Ensure resource for API users",""],["- downtime detection and recovery",""],["- block abnormal traffic",""],["- User account safety; avoid automatic account linking https","//www.ory.sh/docs/kratos/social-signin/overview#dangers-of-automatic-account-linking"],["- Avoid large GCP bill / GCS DDoS attack","move to Cloudflare R2"],["- Discussion","https://g0v.hackmd.io/Jqg-lecyRhKtFDnbxnx_ZA?view#Infra-DDoS-%E5%B8%B3%E5%96%AE%E6%94%BB%E6%93%8A%E9%A0%90%E9%98%B2"],["- [No egress fee](https","//developers.cloudflare.com/r2/pricing) 而且 class A & B operation 比 GCS 的便宜"],["- [Sippy](https","//developers.cloudflare.com/r2/data-migration/sippy/) incremental migration"],["- 可以先只改 rumors-api 輸出 URL 的部分，讓它輸出 R2 URL",""],["",""],["### 現況",""],["",""],["- 1 台 Linode ㄏㄏ",""],["",""],["### Proposal",""],["",""],["- Replace Linode with Cloud service providers to eliminate infra effort",""],["- Manage access on cloud",""],["- Ensure horizontal scalability by leveraging public cloud",""],["- Move servers to behind Cloudflare",""],["- Elasticsrarch > 8",""],["- current 6 does not run on Apple Silicon https","//stackoverflow.com/questions/68877644/how-to-run-elasticsearch-6-on-an-apple-silicon-mac"],["- enables vector search",""],["",""],["#### Phase 1","rumors-site & rumors-line-bot 上 Google cloud run"],["",""],["Benefits of Cloud Run",""],["- Fully managed, but can use container",""],["- Billed only after access",""],["- Can auto-deploy after image updates",""],["- Setup env variable on GCP web console",""],["- Alternative","AWS App Runner ([comparison](https://www.kloia.com/blog/aws-app-runner-vs-google-cloud-run))"]]}}