Chapter 1: Introduction
什麼是作業系統？

- 作業系統是一個介於使用者與計算機硬體之間的程式。
- 作業系統的目標：
  - 執行使用者程式，並使解決使用者問題變得更容易。
  - 使計算機系統更方便使用。
  - 有效地利用計算機硬體。

計算機系統結構

- 計算機系統可以分為四個組件：
  - **硬體** – 提供基本的計算資源
    - CPU、記憶體、I/O 設備
  - **作業系統**
    - 控制並協調硬體在不同應用程式和使用者之間的使用
  - **應用程式** – 定義如何使用系統資源來解決使用者的計算問題
    - 文字處理器、編譯器、網頁瀏覽器、資料庫系統、電子遊戲
  - **使用者**
    - 人、機器、其他計算機
Four Components of a Computer System
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_323a0645edd731f4d923fc3239d12719.PNG)
作業系統的作用

- 取決於不同的觀點
- 使用者希望系統方便、易於使用並且具有良好的性能
- 不太關心資源的使用效率
- 但對於共享電腦（如大型主機或小型電腦），必須保持所有使用者滿意
- 專用系統的使用者（如工作站）擁有專用的資源，但經常使用伺服器上的共享資源
- 手持式計算機資源有限，需針對可用性和電池壽命進行優化
- 一些計算機幾乎沒有使用者介面，例如嵌入式設備中的計算機和汽車內的計算機

作業系統定義

- **作業系統是一個資源分配器**
  - 管理所有資源
  - 在有衝突的請求之間做出決策，以有效且公平地使用資源
- **作業系統是一個控制程式**
  - 控制程式的執行以防止錯誤和不當使用計算機
- 沒有普遍接受的定義
- 「當你訂購作業系統時，供應商提供的所有內容」是一個較好的近似定義
- 但變化非常大
- 「計算機上始終運行的程式」是核心（Kernel）
- 其他部分要麼是
  - 系統程式（隨作業系統一起提供），要麼是
  - 應用程式
計算機啟動

- 啟動程式（bootstrap program）在開機或重新啟動時被載入
- 通常儲存在 ROM 或 EPROM 中，一般稱為韌體（firmware）
- 初始化系統的所有方面
- 載入作業系統核心並開始執行
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_d1c2bded718f484b0515b358bb69ac58.PNG)
計算機系統組織

- 計算機系統運作
- 一個或多個 CPU 和設備控制器通過共用匯流排連接，以便訪問共享記憶體
- CPU 和設備同時執行，競爭記憶體週期
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_4d22a92e4738f7960d50827ba44fe3a2.PNG)
計算機系統運作

- I/O 設備和 CPU 可以同時執行
- 每個設備控制器負責特定的設備類型
- 每個設備控制器都有一個本地緩衝區
- CPU 將資料從主記憶體移動到本地緩衝區，或從本地緩衝區移動到主記憶體
- I/O 從設備傳輸到控制器的本地緩衝區
- 設備控制器透過引發中斷通知 CPU 它已完成操作
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_f8f5beafc8f858cb40f883013a16a6a8.PNG)
中斷的常見功能

- 中斷將控制權轉移到中斷服務程式（ISR），通常是透過中斷向量進行，該向量包含所有服務程式的地址
- 中斷架構必須保存被中斷指令的地址
- 陷阱（trap）或例外（exception）是由軟體產生的中斷，可能是由錯誤或使用者請求引起的
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_39d6218da6122b818eb69a7876d14a3a.PNG)
Interrupt Timeline
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_412acc67279ea54cc43f2482c3289125.PNG)
I/O 結構

- I/O 開始後，只有在 I/O 完成後控制才會返回使用者程式
- 等待指令讓 CPU 閒置，直到下一個中斷發生
- 等待迴圈（競爭記憶體存取）
- 一次最多只有一個 I/O 請求處於進行中，無法同時處理多個 I/O
- I/O 開始後，控制權返回給使用者程式，無需等待 I/O 完成
- 系統呼叫——向作業系統請求，允許使用者等待 I/O 完成
- 設備狀態表包含每個 I/O 設備的條目，指示其類型、地址和狀態
- 作業系統查閱 I/O 設備表以確定設備狀態，並修改表格條目以包括中斷

儲存結構

- 主記憶體——是 CPU 可以直接訪問的唯一大型儲存媒介
  - 隨機存取
  - 通常是易失性的
- 次級儲存——主記憶體的延伸，提供大量的非易失性儲存空間
  - 硬碟——由覆蓋磁性記錄材料的金屬或玻璃盤片構成
  - 磁碟表面邏輯上分為磁軌，磁軌再細分為扇區
  - 磁碟控制器決定設備與計算機之間的邏輯互動
  - 固態硬碟——比硬碟更快，且為非易失性
    - 各種技術
    - 越來越受歡迎
儲存層次結構

- 儲存系統按層次組織
  - 速度
  - 成本
  - 易失性
- 快取——將資訊複製到更快的儲存系統；主記憶體可以視為次級儲存的快取
- 每個設備控制器都有設備驅動程式來管理 I/O
  - 在控制器和核心之間提供統一的介面

儲存設備層次
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_edb549c907575a82c8780ca4d3d89695.PNG)
**快取**

- 重要原則，應用於計算機的多個層級（硬體、作業系統、軟體）
- 正在使用的資訊從較慢的儲存裝置臨時複製到較快的儲存裝置
- 首先檢查較快的儲存裝置（快取）以確定資訊是否已存在
- 如果存在，直接從快取使用資訊（速度快）
- 如果不存在，將資料複製到快取並在那裡使用
- 快取比被快取的儲存裝置小
- 快取管理是重要的設計問題
- 快取大小和替換策略

**直接記憶體存取（DMA）結構**

- 用於能夠以接近記憶體速度傳輸資訊的高速 I/O 設備
- 設備控制器將資料塊從緩衝儲存直接傳輸到主記憶體，無需 CPU 干預
- 每個資料塊只產生一個中斷，而不是每個位元組一個中斷
How a Modern Computer Works
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_f2c3e9303f29c6c23b46dc5a913b49d4.PNG)
計算機系統架構

- 大多數系統使用單一的通用處理器
- 大多數系統也有專用處理器
- 多處理器系統的使用和重要性日益增加
  - 也稱為並行系統、緊耦合系統
- 優點包括：
  1. 提高吞吐量
  2. 節約規模成本
  3. 提高可靠性——優雅降級或容錯能力
- 兩種類型：
  1. **非對稱多處理**——每個處理器被分配特定任務
  2. **對稱多處理**——每個處理器執行所有任務

**對稱多處理架構**
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_ef0bc7ec508b7456c5ecf7d8fc77755b.PNG)
**雙核心設計**

- 多晶片和多核心
- 包含所有晶片的系統
- 包含多個獨立系統的機殼
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_0190d478d495f3f6ca287acebf621f6e.PNG)
**叢集系統**

- 類似多處理器系統，但多個系統一起工作
- 通常通過儲存區域網路（SAN）共享儲存
- 提供高可用性服務，能夠在故障時繼續運作
  - **非對稱叢集**有一台機器處於熱待機模式
  - **對稱叢集**有多個節點運行應用程式並相互監控
- 有些叢集用於高效能計算（HPC）
  - 必須將應用程式編寫為使用並行化
- 有些叢集具有分散式鎖管理器（DLM），以避免操作衝突
Clustered Systems
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_f8e48c2a735730fbc2d4b43ad2f195f8.PNG)
Operating System Structure
**多工處理（批次系統）為提高效率所需**

- 單一使用者無法始終讓 CPU 和 I/O 設備保持忙碌
- 多工處理將作業（程式碼和資料）組織起來，以確保 CPU 始終有一個作業可執行
- 系統中總作業的一部分保存在記憶體中
- 通過作業排程選擇並執行一個作業
- 當該作業需要等待（例如等待 I/O 時），作業系統會切換到另一個作業
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_4e90cae847c4c06ad62602169de39f40.PNG)
**分時（多工處理）是邏輯延伸**

- 在分時系統中，CPU 頻繁地切換作業，使使用者可以在每個作業運行時與其互動，從而創建互動式計算環境
- 回應時間應小於 1 秒
- 每個使用者至少有一個正在記憶體中執行的程式【稱為進程】
- 如果有多個作業準備同時運行【CPU 排程】
- 如果進程無法全部放入記憶體，則透過交換將它們移入和移出記憶體以運行
- 虛擬記憶體允許執行不完全在記憶體中的進程
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_8278493b23f1941786655b51459113cb.PNG)
**作業系統操作**

- 以中斷驅動（硬體和軟體）
- 硬體中斷由其中一個設備觸發
- 軟體中斷（例外或陷阱）：
  - 軟體錯誤（例如，除以零）
  - 請求作業系統服務
  - 其他進程問題包括無限迴圈、進程互相修改或修改作業系統
**雙模式操作**

- 雙模式操作允許作業系統保護自身和其他系統組件
- 使用者模式和核心模式
- 硬體提供的模式位元
  - 提供區分系統運行使用者程式碼或核心程式碼的能力
  - 某些指令被指定為特權指令，僅可在核心模式下執行
  - 系統呼叫會將模式變更為核心模式，從呼叫返回時則重置為使用者模式
- 越來越多的 CPU 支援多模式操作
  - 例如，虛擬機管理器（VMM）模式用於客戶虛擬機
