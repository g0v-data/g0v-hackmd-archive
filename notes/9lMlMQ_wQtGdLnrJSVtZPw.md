Chapter 1: Introduction
什麼是作業系統？

- 作業系統是一個介於使用者與計算機硬體之間的程式。
- 作業系統的目標：
  - 執行使用者程式，並使解決使用者問題變得更容易。
  - 使計算機系統更方便使用。
  - 有效地利用計算機硬體。

計算機系統結構

- 計算機系統可以分為四個組件：
  - **硬體** – 提供基本的計算資源
    - CPU、記憶體、I/O 設備
  - **作業系統**
    - 控制並協調硬體在不同應用程式和使用者之間的使用
  - **應用程式** – 定義如何使用系統資源來解決使用者的計算問題
    - 文字處理器、編譯器、網頁瀏覽器、資料庫系統、電子遊戲
  - **使用者**
    - 人、機器、其他計算機
Four Components of a Computer System
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_323a0645edd731f4d923fc3239d12719.PNG)
作業系統的作用

- 取決於不同的觀點
- 使用者希望系統方便、易於使用並且具有良好的性能
- 不太關心資源的使用效率
- 但對於共享電腦（如大型主機或小型電腦），必須保持所有使用者滿意
- 專用系統的使用者（如工作站）擁有專用的資源，但經常使用伺服器上的共享資源
- 手持式計算機資源有限，需針對可用性和電池壽命進行優化
- 一些計算機幾乎沒有使用者介面，例如嵌入式設備中的計算機和汽車內的計算機

作業系統定義

- **作業系統是一個資源分配器**
  - 管理所有資源
  - 在有衝突的請求之間做出決策，以有效且公平地使用資源
- **作業系統是一個控制程式**
  - 控制程式的執行以防止錯誤和不當使用計算機
- 沒有普遍接受的定義
- 「當你訂購作業系統時，供應商提供的所有內容」是一個較好的近似定義
- 但變化非常大
- 「計算機上始終運行的程式」是核心（Kernel）
- 其他部分要麼是
  - 系統程式（隨作業系統一起提供），要麼是
  - 應用程式
計算機啟動

- 啟動程式（bootstrap program）在開機或重新啟動時被載入
- 通常儲存在 ROM 或 EPROM 中，一般稱為韌體（firmware）
- 初始化系統的所有方面
- 載入作業系統核心並開始執行
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_d1c2bded718f484b0515b358bb69ac58.PNG)
計算機系統組織

- 計算機系統運作
- 一個或多個 CPU 和設備控制器通過共用匯流排連接，以便訪問共享記憶體
- CPU 和設備同時執行，競爭記憶體週期
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_4d22a92e4738f7960d50827ba44fe3a2.PNG)
計算機系統運作

- I/O 設備和 CPU 可以同時執行
- 每個設備控制器負責特定的設備類型
- 每個設備控制器都有一個本地緩衝區
- CPU 將資料從主記憶體移動到本地緩衝區，或從本地緩衝區移動到主記憶體
- I/O 從設備傳輸到控制器的本地緩衝區
- 設備控制器透過引發中斷通知 CPU 它已完成操作
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_f8f5beafc8f858cb40f883013a16a6a8.PNG)
中斷的常見功能

- 中斷將控制權轉移到中斷服務程式（ISR），通常是透過中斷向量進行，該向量包含所有服務程式的地址
- 中斷架構必須保存被中斷指令的地址
- 陷阱（trap）或例外（exception）是由軟體產生的中斷，可能是由錯誤或使用者請求引起的
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_39d6218da6122b818eb69a7876d14a3a.PNG)
Interrupt Timeline
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_412acc67279ea54cc43f2482c3289125.PNG)
I/O 結構

- I/O 開始後，只有在 I/O 完成後控制才會返回使用者程式
- 等待指令讓 CPU 閒置，直到下一個中斷發生
- 等待迴圈（競爭記憶體存取）
- 一次最多只有一個 I/O 請求處於進行中，無法同時處理多個 I/O
- I/O 開始後，控制權返回給使用者程式，無需等待 I/O 完成
- 系統呼叫——向作業系統請求，允許使用者等待 I/O 完成
- 設備狀態表包含每個 I/O 設備的條目，指示其類型、地址和狀態
- 作業系統查閱 I/O 設備表以確定設備狀態，並修改表格條目以包括中斷

儲存結構

- 主記憶體——是 CPU 可以直接訪問的唯一大型儲存媒介
  - 隨機存取
  - 通常是易失性的
- 次級儲存——主記憶體的延伸，提供大量的非易失性儲存空間
  - 硬碟——由覆蓋磁性記錄材料的金屬或玻璃盤片構成
  - 磁碟表面邏輯上分為磁軌，磁軌再細分為扇區
  - 磁碟控制器決定設備與計算機之間的邏輯互動
  - 固態硬碟——比硬碟更快，且為非易失性
    - 各種技術
    - 越來越受歡迎
儲存層次結構

- 儲存系統按層次組織
  - 速度
  - 成本
  - 易失性
- 快取——將資訊複製到更快的儲存系統；主記憶體可以視為次級儲存的快取
- 每個設備控制器都有設備驅動程式來管理 I/O
  - 在控制器和核心之間提供統一的介面

儲存設備層次
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_edb549c907575a82c8780ca4d3d89695.PNG)
**快取**

- 重要原則，應用於計算機的多個層級（硬體、作業系統、軟體）
- 正在使用的資訊從較慢的儲存裝置臨時複製到較快的儲存裝置
- 首先檢查較快的儲存裝置（快取）以確定資訊是否已存在
- 如果存在，直接從快取使用資訊（速度快）
- 如果不存在，將資料複製到快取並在那裡使用
- 快取比被快取的儲存裝置小
- 快取管理是重要的設計問題
- 快取大小和替換策略

**直接記憶體存取（DMA）結構**

- 用於能夠以接近記憶體速度傳輸資訊的高速 I/O 設備
- 設備控制器將資料塊從緩衝儲存直接傳輸到主記憶體，無需 CPU 干預
- 每個資料塊只產生一個中斷，而不是每個位元組一個中斷
How a Modern Computer Works
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_f2c3e9303f29c6c23b46dc5a913b49d4.PNG)
計算機系統架構

- 大多數系統使用單一的通用處理器
- 大多數系統也有專用處理器
- 多處理器系統的使用和重要性日益增加
  - 也稱為並行系統、緊耦合系統
- 優點包括：
  1. 提高吞吐量
  2. 節約規模成本
  3. 提高可靠性——優雅降級或容錯能力
- 兩種類型：
  1. **非對稱多處理**——每個處理器被分配特定任務
  2. **對稱多處理**——每個處理器執行所有任務

**對稱多處理架構**
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_ef0bc7ec508b7456c5ecf7d8fc77755b.PNG)
**雙核心設計**

- 多晶片和多核心
- 包含所有晶片的系統
- 包含多個獨立系統的機殼
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_0190d478d495f3f6ca287acebf621f6e.PNG)
**叢集系統**

- 類似多處理器系統，但多個系統一起工作
- 通常通過儲存區域網路（SAN）共享儲存
- 提供高可用性服務，能夠在故障時繼續運作
  - **非對稱叢集**有一台機器處於熱待機模式
  - **對稱叢集**有多個節點運行應用程式並相互監控
- 有些叢集用於高效能計算（HPC）
  - 必須將應用程式編寫為使用並行化
- 有些叢集具有分散式鎖管理器（DLM），以避免操作衝突
Clustered Systems
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_f8e48c2a735730fbc2d4b43ad2f195f8.PNG)
Operating System Structure
**多工處理（批次系統）為提高效率所需**

- 單一使用者無法始終讓 CPU 和 I/O 設備保持忙碌
- 多工處理將作業（程式碼和資料）組織起來，以確保 CPU 始終有一個作業可執行
- 系統中總作業的一部分保存在記憶體中
- 通過作業排程選擇並執行一個作業
- 當該作業需要等待（例如等待 I/O 時），作業系統會切換到另一個作業
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_4e90cae847c4c06ad62602169de39f40.PNG)
**分時（多工處理）是邏輯延伸**

- 在分時系統中，CPU 頻繁地切換作業，使使用者可以在每個作業運行時與其互動，從而創建互動式計算環境
- 回應時間應小於 1 秒
- 每個使用者至少有一個正在記憶體中執行的程式【稱為進程】
- 如果有多個作業準備同時運行【CPU 排程】
- 如果進程無法全部放入記憶體，則透過交換將它們移入和移出記憶體以運行
- 虛擬記憶體允許執行不完全在記憶體中的進程
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_8278493b23f1941786655b51459113cb.PNG)
**作業系統操作**

- 以中斷驅動（硬體和軟體）
- 硬體中斷由其中一個設備觸發
- 軟體中斷（例外或陷阱）：
  - 軟體錯誤（例如，除以零）
  - 請求作業系統服務
  - 其他進程問題包括無限迴圈、進程互相修改或修改作業系統
**雙模式操作**

- 雙模式操作允許作業系統保護自身和其他系統組件
- 使用者模式和核心模式
- 硬體提供的模式位元
  - 提供區分系統運行使用者程式碼或核心程式碼的能力
  - 某些指令被指定為特權指令，僅可在核心模式下執行
  - 系統呼叫會將模式變更為核心模式，從呼叫返回時則重置為使用者模式
- 越來越多的 CPU 支援多模式操作
  - 例如，虛擬機管理器（VMM）模式用於客戶虛擬機
**從使用者模式轉換到核心模式**

- 設置計時器以防止無限迴圈或進程佔用資源
- 計時器設定為在某段時間後中斷計算機
- 保持一個計數器，該計數器由物理時鐘遞減
- 作業系統設置計數器（特權指令）
- 當計數器為零時產生中斷
- 在排程過程之前設置，以重新獲取控制權或終止超過分配時間的程式
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_5ff59f348f88ec04c285bbfdb1770c6e.PNG)
**進程管理**

- 進程是正在執行的程式。它是系統中的一個工作單位。程式是被動實體，而進程是主動實體。
- 進程需要資源來完成其任務：
  - CPU、記憶體、I/O、文件
  - 初始化數據
- 進程終止時需要回收任何可重用的資源。
- 單執行緒進程有一個程式計數器，指定要執行的下一條指令的位置。
- 進程按順序執行指令，一次一條，直到完成。
- 多執行緒進程每個執行緒都有一個程式計數器。
- 通常系統中有許多進程，一些是使用者進程，一些是作業系統進程，這些進程在一個或多個 CPU 上同時運行。
- 通過在進程/執行緒之間進行 CPU 的多路復用來實現並發。
**進程管理活動**

作業系統負責與進程管理相關的以下活動：

- 創建和刪除使用者和系統進程
- 暫停和恢復進程
- 提供進程同步的機制
- 提供進程通信的機制
- 提供死鎖處理的機制
**記憶體管理**

- 要執行一個程式，所有（或部分）指令必須在記憶體中
- 程式所需的所有（或部分）數據必須在記憶體中
- 記憶體管理決定什麼時候將什麼放入記憶體
- 優化 CPU 的使用率和計算機對使用者的響應
- 記憶體管理活動包括：
  - 跟蹤哪些記憶體部分當前正在被使用以及由誰使用
  - 決定哪些進程（或其部分）和數據需要進入或退出記憶體
  - 根據需要分配和釋放記憶體空間
**儲存管理**

- 作業系統提供統一的邏輯資訊儲存視圖
- 將物理屬性抽象為邏輯儲存單位——文件
- 每個媒介由設備控制（例如，磁碟驅動器、磁帶驅動器）
  - 不同的屬性包括存取速度、容量、數據傳輸速率、存取方法（順序或隨機）
  
**文件系統管理**

- 文件通常組織成目錄
- 大多數系統都有存取控制，以確定誰可以訪問哪些內容
- 作業系統的活動包括：
  - 創建和刪除文件和目錄
  - 操作文件和目錄的原語
  - 將文件映射到次級儲存
  - 將文件備份到穩定（非揮發性）儲存媒介
**大容量儲存管理**

- 通常使用磁碟來存儲不適合放入主記憶體的數據或必須保留“長期”使用的數據
- 正確的管理至關重要
- 整個計算機操作的速度取決於磁碟子系統及其算法

**作業系統的活動**

- 空閒空間管理
- 儲存分配
- 磁碟排程

- 某些儲存不必快速
- 第三儲存（Tertiary storage）包括光碟儲存和磁帶
- 仍然必須進行管理——由作業系統或應用程式管理
- 存儲介質的性質各異，包括 WORM（一次寫入，多次讀取）和 RW（讀寫）
**各種儲存層級的性能**
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_9e78e44e1a05445f145e90c8b16e1724.PNG)
**將數據“A”從磁碟遷移到寄存器**

- 在多任務環境中，必須小心使用最新的值，無論該值儲存在儲存層級的哪個位置。
- ![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_15fa189976a20fdd1ed33deb7eaa5ae0.PNG)
**多處理器環境**

- 多處理器環境必須提供硬體快取一致性，以確保所有 CPU 的快取中都具有最新的值。
- 在分散式環境中，情況更加複雜。
- 數據的多個副本可能存在。
- 各種解決方案在第 17 章中進行了討論。

**I/O 子系統**

- 作業系統的一個目的是隱藏硬體設備的特殊性，以便使用者能夠更方便地使用。
- I/O 子系統負責以下內容：
  - I/O 的記憶體管理，包括緩衝（在數據轉移過程中臨時儲存數據）、快取（將部分數據儲存在更快的存儲中以提高性能）、列印緩衝（將一個作業的輸出與其他作業的輸入重疊）。
  - 通用設備驅動程式介面。
  - 針對特定硬體設備的驅動程式。
**保護與安全**

- **保護** - 任何控制進程或使用者對作業系統所定義資源的訪問機制。
- **安全** - 防禦系統免受內部和外部攻擊的措施。
- 涉及範圍廣泛，包括拒絕服務攻擊、蠕蟲、病毒、身份盜竊、服務盜竊等。
- 系統通常首先區分使用者，以確定誰可以執行什麼操作。
- 使用者身份（使用者 ID、安全 ID）包括名稱和相關的編號，每位使用者一個。
- 使用者 ID 會與該使用者的所有文件和進程相關聯，以確定訪問控制。
- 群組識別符（群組 ID）允許定義一組使用者並管理其控制權，然後也與每個進程和文件相關聯。
- 特權提升允許使用者更改為擁有更多權限的有效 ID。
**核心數據結構**

- 許多數據結構類似於標準編程數據結構。
- 單向鏈表（Singly linked list）。
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_5702613b0c6b666597a00675a459b8ed.PNG)
- **二叉搜索樹（Binary search tree）**
  - 左子樹的值小於等於根節點的值，右子樹的值大於根節點的值。
  
- 搜索性能為 O(n)。
  
- 平衡二叉搜索樹的搜索性能為 O(log n)。
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_6dd040b46a46b90c1849229bdf32eb26.PNG)

**核心數據結構**

- 哈希函數可以創建哈希映射（hash map）。
- 位圖（Bitmap）— 一串 n 個二進位數字，表示 n 個項目的狀態。
- Linux 數據結構定義在以下包含文件中：
  - `<linux/list.h>`
  - `<linux/kfifo.h>`
  - `<linux/rbtree.h>`
**計算環境 - 傳統**

- 獨立的通用計算機。
- 但隨著大多數系統與其他系統互連（即，互聯網），界線變得模糊。
- 入口網站提供對內部系統的網頁訪問。
- 網絡計算機（瘦客戶端）類似於網頁終端。
- 移動計算機通過無線網絡互連。
- 網絡變得無處不在——甚至家庭系統也使用防火牆來保護家庭計算機免受互聯網攻擊。
**計算環境 - 行動**

- 手持式智慧型手機、平板電腦等。
- 它們與「傳統」筆記型電腦之間的功能差異是什麼？
  - 額外的功能 – 更多的作業系統功能（如 GPS、陀螺儀）。
  - 允許新的應用類型，如擴增實境（augmented reality）。
- 使用 IEEE 802.11 無線或行動數據網絡進行連接。
- 主要領導者是 Apple iOS 和 Google Android。

---

**計算環境 - 客戶端-伺服器**

- **客戶端-伺服器計算**
  - 傻瓜終端被智慧型個人電腦所取代。
  - 現在許多系統作為伺服器，回應客戶端生成的請求。
    - 計算伺服器系統提供介面讓客戶端請求服務（例如，資料庫）。
    - 檔案伺服器系統提供介面供客戶端存儲和檢索檔案。
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_5e6c56a01873ec122c4f30c7460cec0e.PNG)
**計算環境 - 對等網路**

- 另一種分散式系統模型。
- P2P（對等網路）不區分客戶端和伺服器。
- 相反，所有節點都被視為對等體。
- 每個節點都可以作為客戶端、伺服器或兩者兼具。
- 節點必須加入 P2P 網路。
  - 在網路上的中央查找服務中註冊其服務，或
  - 通過發送服務請求的廣播來查找服務，並通過發現協議回應服務請求。
- 例子包括 Napster 和 Gnutella，以及 VoIP（語音傳輸協議）如 Skype。
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_57bd88029e7bb5e2b5495d7b581aa7b2.PNG)

**計算環境 - 虛擬化**

- 允許操作系統在其他操作系統內運行應用程序。
- 這是一個龐大且不斷增長的產業。
- 當源 CPU 類型與目標類型不同（例如，PowerPC 到 Intel x86）時，使用模擬。
  - 這通常是最慢的方法。
- 當計算機語言未編譯為本地代碼時，使用解釋（Interpretation）。
- 虛擬化 – 操作系統是為 CPU 原生編譯的，運行的客戶操作系統也同樣是原生編譯的。
  - 考慮 VMware 運行 WinXP 客戶系統，每個系統運行應用程序，全部在原生的 WinXP 主操作系統上。
- VMM（虛擬機管理器）提供虛擬化服務。
- 使用案例涉及在筆記型電腦和桌面上運行多個操作系統，以便進行探索或兼容性測試。
- 例如，Apple 筆記型電腦運行 Mac OS X 作為主機，Windows 作為來賓系統。
- 可以在不擁有多個系統的情況下開發多個操作系統的應用程序。
- 進行應用程序的質量保證測試而不需要多個系統。
- 在數據中心內執行和管理計算環境。
- VMM（虛擬機管理器）可以原生運行，在這種情況下它們也充當主機。
- 那麼就沒有通用的主機了（如 VMware ESX 和 Citrix XenServer）。
Computing Environments - Virtualization
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_20eb481343bdef9efda7183eb1b8899b.PNG)
**計算環境 - 雲計算**

- 提供計算、存儲，甚至應用作為服務通過網絡進行交付。
- 雲計算是虛擬化的邏輯延伸，因為它使用虛擬化作為其功能的基礎。
- 例如，Amazon EC2 擁有數千台伺服器、數百萬個虛擬機器和可通過互聯網獲得的數PB的存儲，按使用量付費。
- 雲計算的類型包括：
  - **公共雲** – 通過互聯網提供給任何願意付費的人使用。
  - **私有雲** – 由公司運行，用於公司的自身使用。
  - **混合雲** – 包括公共雲和私有雲組件。
  - **軟件即服務 (SaaS)** – 通過互聯網提供的一個或多個應用程序（例如，文字處理器）。
  - **平台即服務 (PaaS)** – 可通過互聯網使用的軟件堆棧（例如，數據庫伺服器）。
  - **基礎設施即服務 (IaaS)** – 可通過互聯網獲得的伺服器或存儲（例如，備份用的存儲）。
- 雲計算環境由傳統操作系統、虛擬機管理器和雲管理工具組成。
- 互聯網連接需要安全性，例如防火牆。
- 負載均衡器將流量分配到多個應用程序中。
![](https://s3-ap-northeast-1.amazonaws.com/g0v-hackmd-images/uploads/upload_ae1e6e45ca12742d83a45736d247a827.PNG)
**開源操作系統**

- 操作系統以源代碼格式提供，而不僅僅是二進制的閉源格式。
- 這是對拷貝保護和數字權利管理（DRM）運動的反對。
- 由自由軟體基金會（Free Software Foundation, FSF）發起，該基金會擁有「copyleft」的GNU公共許可證（GPL）。
- 例子包括GNU/Linux和BSD UNIX（包括Mac OS X的核心），以及更多其他系統。
- 可以使用虛擬機管理器（VMM），例如VMware Player（在Windows上免費提供）和VirtualBox（在多個平台上開源和免費，網址：http://www.virtualbox.com）。
- 用於運行來賓操作系統以進行探索。