# MDR的筆記

---

## 1 整體環境概況

| 項目         | 現況                                     | 備註                                                                    |
| ---------- | -------------------------------------- | --------------------------------------------------------------------- |
| **MDR 專案** | 今年正式擴大至1300                           | 公司 SOC 端提供 24×7 代管 (Managed Detection & Response)                     |
| **授權數**    | 總量 1300 點，目前已部署 1240                   | 皆屬 **S1 / S2** 兩層級<br>— **S1**：核心服務／研發編譯主機，權重最高<br>— **S2**：一般伺服器與 PC |
| **常用模式**   | 事件監控 (Incidents)、威脅狩獵 (Threat Hunting) | 透過 Console 右上角「篩選器」一次套用預設與客製規則                                        |

---

## 2 日常運維流程

### 2.1 事件調閱步驟

1. **先找主機**

   * 以「主機名稱」搜尋進入詳細畫面。
   * 首頁會顯示事件圖 (Attack Storyline)、官方 *Remediation Tips*（僅供參考。需依內規判斷）。

2. **鎖定三大欄位**

   * **Time**（UTC+8）
   * **PID / Parent PID**：用來拼接完整 Process Tree。
   * **Command Line / SHA1**：判斷行為與真偽。

3. **由 Event 追蹤**

   * 事件之間常具連續性（如 spawn → write → execute）。
   * 檢查相同 PID 是否存在多筆行為，或 Parent PID 是否延伸出異常子程序。

### 2.2 通報範例（內部 SOP）

> **主旨**：T1BC114 主機疑似異常行為確認
> **對象**：負責人 \<xx>
> **內文範例**
>
> Hi \<xx>，我是資安部 KW。<br>
> 於 **2025-06-19 15:46:22 +0800** 我們在 **T1BC114** 偵測到一則高階告警：
> `find /home/dan/titan3_2/.../libapparmor.so.1 (-perm -004000 -o -perm -002000) -type f -print`
> 判讀可能與 **Build Code** 流程相關，請確認當時是否進行編譯或權限檢查。若屬正常開發行為，我們將標註為誤報並關閉事件；如非授權操作，請協助進一步說明。<br>
> 感謝！

> **備註**：
>
> * 告警敘述需包含「時間、主機、指令、風險分級」。
> * 若對方 24 小時內未回覆，依 SLA 升級/電話告警。

---

## 3 威脅狩獵（Threat Hunting）

| 步驟            | 操作                                                                                                    | 補充                           |
| ------------- | ----------------------------------------------------------------------------------------------------- | ---------------------------- |
| **(1) 時間範圍**  | 固定「近 7 天」                                                                                             | 與 SOC 報表週期一致                 |
| **(2) 嚴重度**   | `Severity ≥ 3`                                                                                        | 過濾雜訊，聚焦高/中危事件                |
| **(3) 關鍵服務**  | - `RDXService` ：Microsoft Remote Desktop 相關，屬系統服務<br>- `Edd` ：原廠程式（確認簽章）<br>- `auth` ：內部測試字串 (自製 PoC) | 看到上述名稱時先比對白名單，避免誤報           |
| **(4) 多主機分析** | 點擊「進階屬性 (Advanced Filters)」                                                                           | 可一次篩出相同 Hash / IP 的跨主機事件     |
| **(5) 分析維度**  | 行為用途、來源路徑、與主機角色關聯、是否第三方程式、觸發原因                                                                        | 形成根因報告 (Root Cause Analysis) |

---

## 4 端點狀態圖示解讀

| 圖示                | 說明                | 待辦                                                                                        |
| ----------------- | ----------------- | ----------------------------------------------------------------------------------------- |
| **實心綠**           | 線上、每日 05:00 自動掃描  | 正常                                                                                        |
| **灰色**            | 被動式僅接收日誌，無掃描權限    | 覆蓋率低，評估是否需升級                                                                              |
| **空心綠**           | Agent 常駐但連線異常     | 1️⃣ `nslookup <console FQDN>`<br>2️⃣ `curl -I http://<console_IP>` 與 `https://` 確認 80/443 |
| **封存 (Archived)** | Agent 已移除並封存，不占授權 | **程序**：先解除安裝 → 再封存<br>保留留痕，釐清責任                                                           |

> **授權管理提示**：若需釋放授權，務必走「解除安裝 → 封存」流程，避免日後缺少稽核紀錄。

---

## 5 弱密碼追蹤 (Weak Password Hunting)

1. **Threat Hunting → Filter：近 7 天 + 類別 ＝ `Weak User / Weak Credential`**
2. 展開 `Scan History`，找出 `Weak User` 列表。
3. 匯出報告並通知系統負責人：

   * 列出帳號、主機、風險描述。
   * 給出修改建議（長度 ≥ 12 碼、複雜度、定期輪替）。
4. 追蹤進度，確保 14 天內完成複驗。

---

## 6 小技巧 & 常見疑問

| 問題                            | 快速答案                                                 |
| ----------------------------- | ---------------------------------------------------- |
| **Q : 為何同指令在 A 機觸發告警、B 機沒有？** | B 機可能屬於灰色被動掃描；或白名單規則版本不同。確認 Agent 配置與 Policy 版本。     |
| **Q : PID 找不到對應事件？**          | 程式已結束且被系統回收。改從 Parent PID 或 Hash 追蹤。                 |
| **Q : 想一次查看 S1 主機的高危事件？**     | `Host Group = S1` + `Severity ≥ 4`，可存成 Saved Search。 |

---

### 結語

以上把學長的口頭分享轉為可操作、可落地的筆記格式。

* **事件調閱**、**威脅狩獵**、**弱密碼稽核** 是每日／每週必做。
* **圖示狀態判讀** 與 **授權封存流程** 關乎營運與合規。

建議把「Saved Search」及通報模板放入團隊 Wiki，並配合 Jira 或 ServiceNow 流程，才能在 SOC 值班或稽核時快速引用。祝實習順利！
