## Api Gateway 2024/11/13

### 現行機制 :
前端呼叫API 
→ Api Gateway filter 進行驗證 (通過繼續，不通過返回403身分驗證失敗)
→ 成功進入後台API

#### 優點:
目前是進入下游容器之前，對所有路徑進行身分檢查，防止未經授權的用戶訪問敏感資源。因為對所有路徑都進行檢查，這可以模糊容器中API的實體路徑(不論200或404所有的不合法路徑都會優先被403攔截)
#### 缺點:
由於目前的架構網頁前端需要403的響應做部分判斷，修改為404


這會讓容器的入口曝露出來: 

我們的處理:
* 方法1:進行身分檢查，即使猜到正確的API路由沒有通過檢查依然會被403擋住。
* 方法2:進行限流，利用XX進行限流，防止攻擊者通過自動化腳本大量嘗試不同的路徑。


### 預想修改機制一 :
啟動時記錄所有server的路由
→ 將路由返回給Api Gateway 並開啟成路由白名單
→ 前端呼叫API 
→ Api Gateway filter 進行路由白名單比對(通過繼續，不通過返回404)
→ Api Gateway filter 進行驗證 (通過繼續，不通過返回403身分驗證失敗)
→ 成功進入後台API

#### 缺點:
路由如果有pathvatiable會較難比對(複雜)，或比對不完全，且此種路由是使用包含比對，若路由為 path/{uid} 這樣path/之後的內容都會通過。

### 預想修改機制二 :
前端呼叫API 
→ Api Gateway filter 先進行下游API流通並接收返回狀態碼(通過繼續，404返回404)
→ Api Gateway filter 進行驗證 (通過繼續，不通過返回403身分驗證失敗)
→ 成功進入後台API

#### 缺點:
所有的API請求再不經過驗證就執行，無形中會增加許多伺服器的負擔(被無效請求攻擊時)。

### 預想修改機制三 :
前端呼叫API 
→ Api Gateway filter 進行驗證 (通過繼續，不通過返回404身分驗證失敗)
→ 成功進入後台API


#### 缺點:
所有的API請求再不經過驗證就執行，無形中會增加許多伺服器的負擔(被無效請求攻擊時)。












### 在原本的聯絡人func上加上寄信給對方的功能(有開關)
- [x] 開發寄信功能
- [x] 函數的輸入物件DTO加入開關屬性
- [x] 開發寄信開關功能
- [x] 開關屬性使用預設值，避免對現有的API呼叫進行大範圍改動 
- [ ] 需要在註冊時將uuid記錄到表"address_book_email"
- [ ] 開發API路徑讓前端使用，使其能抓到會員是否寄信的開關

:::info
**新增資料表紀錄是否發送郵件**
 * 新增資料表"address_book_email"
 * 填入DB的方式使用Dbeaver的進階複製與進階貼上
 * 目前關閉(註解掉物件 DAO Service)10/28:jeff使用程式內控制(開關)不對外使用按鈕，新建表格與相關物件目前全部關閉不使用
:::